# 設計ルール

- 層の責務
  - commands: 入出力整形、サービス呼び出し、非同期タスク起動
  - services: ドメイン/ユースケースの中心。検証、状態遷移、外部I/Oのオーケストレーション
  - repositories: 永続化層。生SQLとDB I/Oのみ。ビジネスロジックは禁止
- 依存方向は一方向（UI → commands → services → repositories）
- DTO/ペイロードは `db/models.rs` に集約
- 例外方針: `anyhow::Result` で起点へ委譲、ユーザー返却は文字列化
- ログ方針: 機微情報（トークン、クライアントシークレット）は出力禁止
- 設定: 固定ポート(1421)・DBパスは`sqlite:../app.sqlite`（設計意図に準拠）
- セキュリティ: CSRF(state) を必ず検証
- トークン管理: API実行前に有効期限を確認し、必要に応じてリフレッシュ（サービス層の共通関数を経由）
